/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package solace.library;


import com.itextpdf.text.FontFactory;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.pdf.PdfWriter;
import java.awt.Font;
import java.io.File;
import java.io.FileOutputStream;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

/**
 *
 * @author sachith
 */
public class Fine_Calculation extends javax.swing.JPanel {

    /**
     * Creates new form Fine_Calculation
     */
    public Fine_Calculation() {
        initComponents();
        
        date();
    }
    
    
    public void date(){
        
        Date date = new Date();
        
        jdc_DtoR.setDate(date);
        
        jdc_DtoREde.setDate(date);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lbl_Dashboard1 = new javax.swing.JLabel();
        lbl_dashicon = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        lbl_Dashboard23 = new javax.swing.JLabel();
        lbl_Belated = new javax.swing.JLabel();
        lbl_Dashboard24 = new javax.swing.JLabel();
        lbl_finetot1 = new javax.swing.JLabel();
        btn_print = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        lbl_Dashboard19 = new javax.swing.JLabel();
        jdc_DtoR = new com.toedter.calendar.JDateChooser();
        lbl_Dashboard21 = new javax.swing.JLabel();
        jdc_DtoREde = new com.toedter.calendar.JDateChooser();
        lbl_Dashboard22 = new javax.swing.JLabel();
        txt_cost = new javax.swing.JTextField();
        btn_clear = new javax.swing.JButton();
        btn_calculate = new javax.swing.JButton();

        setBackground(new java.awt.Color(242, 242, 242));
        setPreferredSize(new java.awt.Dimension(930, 590));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbl_Dashboard1.setFont(new java.awt.Font("Century Gothic", 0, 18)); // NOI18N
        lbl_Dashboard1.setForeground(new java.awt.Color(105, 105, 105));
        lbl_Dashboard1.setText("Fine Calculation");
        add(lbl_Dashboard1, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 20, 150, 20));

        lbl_dashicon.setFont(new java.awt.Font("Century Gothic", 0, 18)); // NOI18N
        lbl_dashicon.setForeground(new java.awt.Color(105, 105, 105));
        lbl_dashicon.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/btnfinecal icon.png"))); // NOI18N
        add(lbl_dashicon, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 10, 40, 40));

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 85, 125), 2, true));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbl_Dashboard23.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        lbl_Dashboard23.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Dashboard23.setText("Belated Days :");
        jPanel1.add(lbl_Dashboard23, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 60, 120, 20));

        lbl_Belated.setFont(new java.awt.Font("Century Gothic", 1, 16)); // NOI18N
        lbl_Belated.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Belated.setText("0");
        jPanel1.add(lbl_Belated, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 60, 90, 20));

        lbl_Dashboard24.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        lbl_Dashboard24.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Dashboard24.setText("Total fine:");
        jPanel1.add(lbl_Dashboard24, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 120, 90, 20));

        lbl_finetot1.setFont(new java.awt.Font("Century Gothic", 1, 16)); // NOI18N
        lbl_finetot1.setForeground(new java.awt.Color(102, 102, 102));
        lbl_finetot1.setText("Rs: 0.00");
        jPanel1.add(lbl_finetot1, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 120, 90, 20));

        btn_print.setBackground(new java.awt.Color(0, 85, 125));
        btn_print.setFont(new java.awt.Font("Century Gothic", 1, 14)); // NOI18N
        btn_print.setForeground(new java.awt.Color(255, 255, 255));
        btn_print.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/printer.png"))); // NOI18N
        btn_print.setText("Print Recipt");
        btn_print.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        btn_print.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btn_printMouseClicked(evt);
            }
        });
        jPanel1.add(btn_print, new org.netbeans.lib.awtextra.AbsoluteConstraints(80, 210, 150, 40));

        add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(560, 130, 310, 290));

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 85, 125), 1, true), "Fines", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Century Gothic", 1, 18), new java.awt.Color(102, 102, 102))); // NOI18N
        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbl_Dashboard19.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        lbl_Dashboard19.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Dashboard19.setText("Date to return:");
        jPanel2.add(lbl_Dashboard19, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 60, 130, 20));

        jdc_DtoR.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.add(jdc_DtoR, new org.netbeans.lib.awtextra.AbsoluteConstraints(210, 60, 240, -1));

        lbl_Dashboard21.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        lbl_Dashboard21.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Dashboard21.setText("Date returned:");
        jPanel2.add(lbl_Dashboard21, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 150, 130, 20));

        jdc_DtoREde.setBackground(new java.awt.Color(255, 255, 255));
        jdc_DtoREde.addPropertyChangeListener(new java.beans.PropertyChangeListener() {
            public void propertyChange(java.beans.PropertyChangeEvent evt) {
                jdc_DtoREdePropertyChange(evt);
            }
        });
        jPanel2.add(jdc_DtoREde, new org.netbeans.lib.awtextra.AbsoluteConstraints(210, 150, 240, -1));

        lbl_Dashboard22.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        lbl_Dashboard22.setForeground(new java.awt.Color(102, 102, 102));
        lbl_Dashboard22.setText("Fine per day:");
        jPanel2.add(lbl_Dashboard22, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 220, 130, 20));

        txt_cost.setBackground(new java.awt.Color(255, 255, 255));
        txt_cost.setFont(new java.awt.Font("Century Gothic", 0, 16)); // NOI18N
        txt_cost.setForeground(new java.awt.Color(69, 73, 74));
        txt_cost.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(105, 105, 105), 1, true));
        jPanel2.add(txt_cost, new org.netbeans.lib.awtextra.AbsoluteConstraints(210, 220, 240, -1));

        btn_clear.setBackground(new java.awt.Color(0, 85, 125));
        btn_clear.setFont(new java.awt.Font("Century Gothic", 1, 14)); // NOI18N
        btn_clear.setForeground(new java.awt.Color(255, 255, 255));
        btn_clear.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/clear.png"))); // NOI18N
        btn_clear.setText("Clear");
        btn_clear.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btn_clearMouseClicked(evt);
            }
        });
        jPanel2.add(btn_clear, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 300, 150, -1));

        btn_calculate.setBackground(new java.awt.Color(0, 85, 125));
        btn_calculate.setFont(new java.awt.Font("Century Gothic", 1, 14)); // NOI18N
        btn_calculate.setForeground(new java.awt.Color(255, 255, 255));
        btn_calculate.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/accounting.png"))); // NOI18N
        btn_calculate.setText("Calculate ");
        btn_calculate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_calculateActionPerformed(evt);
            }
        });
        jPanel2.add(btn_calculate, new org.netbeans.lib.awtextra.AbsoluteConstraints(280, 300, 150, 40));

        add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 100, 530, 380));
    }// </editor-fold>//GEN-END:initComponents

    private void btn_calculateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_calculateActionPerformed
        
        if(txt_cost.getText().isEmpty()){
            
            JOptionPane.showMessageDialog(null,"Please Enter the Fines Per Day Amount ");
        }
        
        else{
            
            SimpleDateFormat format = new SimpleDateFormat("dd-MM-yyyy");
        
        Date d1 =null;
        Date d2 =null;
        
        
        try {
            
            d1 = format.parse(format.format(jdc_DtoR.getDate()));
            d2 = format.parse(format.format(jdc_DtoREde.getDate()));

            
        } catch (Exception e) {
            e.printStackTrace();
        }
        
        long diff = d2.getTime() - d1.getTime();
        long hours = diff/(60*60*1000);
        long days = hours/24;
        
        String d= Long.toString(days);
        
        if(d2.getTime() > d1.getTime()){
            
            lbl_Belated.setText(d); 
            
            
            double tot;
        
            
            if(txt_cost.getText().isEmpty()){
                
                JOptionPane.showMessageDialog(null,"Please Enter the Fines Per Day Amount ");
            }
            
            else{
                
                tot= Integer.parseInt(d) * Integer.parseInt(txt_cost.getText());
        
                 String fiinetot = Double.toString(tot);
        
                 lbl_finetot1.setText("Rs: "+fiinetot);
            }
        
        }
        
        else{
            lbl_Belated.setText("0");
            txt_cost.setText("0");
        }
        }
        
        
    }//GEN-LAST:event_btn_calculateActionPerformed

    private void jdc_DtoREdePropertyChange(java.beans.PropertyChangeEvent evt) {//GEN-FIRST:event_jdc_DtoREdePropertyChange
        // TODO add your handling code here:
    }//GEN-LAST:event_jdc_DtoREdePropertyChange

    private void btn_clearMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btn_clearMouseClicked
        txt_cost.setText("");
        lbl_Belated.setText("0");
        lbl_finetot1.setText("Rs: 0.00");
        
        Date date = new Date();
        
        jdc_DtoR.setDate(date);
        
        jdc_DtoREde.setDate(date);
    }//GEN-LAST:event_btn_clearMouseClicked

    private void btn_printMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btn_printMouseClicked
        
        if(txt_cost.getText().isEmpty()){
            
            JOptionPane.showMessageDialog(null,"Please Enter the Fines Per Day Amount");
            
        }
        
        else if(txt_cost.getText().equals("0")){
            
            JOptionPane.showMessageDialog(null,"Please Check Date Range");
        }
        
        else{
            
            
            String cost = txt_cost.getText();
            String returned_date = ((JTextField)jdc_DtoR.getDateEditor().getUiComponent()).getText();
            String date = ((JTextField)jdc_DtoREde.getDateEditor().getUiComponent()).getText();
            String BelatedD = lbl_Belated.getText();
            String totfine = lbl_finetot1.getText();
            
            
            JFileChooser dialog = new JFileChooser();
            dialog.setSelectedFile(new File(returned_date +" "+"-Fine Slip"+".pdf"));
            int dialogResult = dialog.showSaveDialog(null);
            
            if(dialogResult==JFileChooser.APPROVE_OPTION){
                
             String filePath = dialog.getSelectedFile().getPath();
             
                try {
                    
                    
                 com.itextpdf.text.Document myDocument = new com.itextpdf.text.Document();
                 PdfWriter myWriter = PdfWriter.getInstance(myDocument, new FileOutputStream(filePath));
                 
                 myDocument.open();
                 
                 
                 
                 
                myDocument.add(new Paragraph("Solace Library",FontFactory.getFont(FontFactory.TIMES_BOLD,20,Font.BOLD )));
           myDocument.add(new Paragraph(new Date().toString()));
          
           
           myDocument.add(new Paragraph("-------------------------------------------------------------------------------------------"));
           myDocument.add(new Paragraph("DATE",FontFactory.getFont(FontFactory.TIMES_ROMAN,15,Font.BOLD)));
           myDocument.add(new Paragraph("Returned date: "+returned_date,FontFactory.getFont(FontFactory.TIMES_ROMAN,10,Font.PLAIN)));
           myDocument.add(new Paragraph("Return Date: "+date ,FontFactory.getFont(FontFactory.TIMES_ROMAN,10,Font.PLAIN)));
           myDocument.add(new Paragraph("Belated Days: "+BelatedD ,FontFactory.getFont(FontFactory.TIMES_ROMAN,10,Font.PLAIN)));
           myDocument.add(new Paragraph("-------------------------------------------------------------------------------------------"));
           myDocument.add(new Paragraph("TOTAL FINE",FontFactory.getFont(FontFactory.TIMES_ROMAN,15,Font.BOLD)));
           myDocument.add(new Paragraph("Fine per day: Rs "+cost,FontFactory.getFont(FontFactory.TIMES_ROMAN,10,Font.PLAIN)));
           myDocument.add(new Paragraph("Total fine: "+totfine,FontFactory.getFont(FontFactory.TIMES_ROMAN,10,Font.PLAIN)));
           myDocument.add(new Paragraph("-------------------------------------------------------------------------------------------"));

           myDocument.close();
           
           JOptionPane.showMessageDialog(null,"Recipt was successfully generated");
                    
                } catch (Exception e) {
                    JOptionPane.showMessageDialog(null,e);
                }
                
            }
        }
    }//GEN-LAST:event_btn_printMouseClicked


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_calculate;
    private javax.swing.JButton btn_clear;
    private javax.swing.JButton btn_print;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private com.toedter.calendar.JDateChooser jdc_DtoR;
    private com.toedter.calendar.JDateChooser jdc_DtoREde;
    private javax.swing.JLabel lbl_Belated;
    private javax.swing.JLabel lbl_Dashboard1;
    private javax.swing.JLabel lbl_Dashboard19;
    private javax.swing.JLabel lbl_Dashboard21;
    private javax.swing.JLabel lbl_Dashboard22;
    private javax.swing.JLabel lbl_Dashboard23;
    private javax.swing.JLabel lbl_Dashboard24;
    private javax.swing.JLabel lbl_dashicon;
    private javax.swing.JLabel lbl_finetot1;
    private javax.swing.JTextField txt_cost;
    // End of variables declaration//GEN-END:variables
}
